# ================================================================
# 磁場・温度一括ベイズ推定プログラム用 設定ファイル (config_unified_gpu.yml)
# unified_weighted_bayesian_fitting_gpu.py 専用
# ================================================================

# --- ファイルパス設定 ---
file_paths:
  # データ読み込み設定 (リスト形式で複数指定可能)
  input_files:
    # 1. 温度変化データ (磁場固定)
    - file_path: "./BayesianInput_Raw_Transmittance_Temperature.xlsx"
      sheet: "Normalized Data" # シート名指定を追加（オプション）
      type: "temperature"
      fixed_param: 9.0  # 固定磁場 (Tesla)
      description: "温度変化データ (B=9.0T固定)"

    # 2. 磁場変化データ (温度固定)
    - file_path: "./BayesianInput_Raw_Transmittance_Field.xlsx"
      sheet: "Normalized Data" # シート名指定を追加（オプション）
      type: "field"
      fixed_param: 4.0  # 固定温度 (Kelvin)
      description: "磁場変化データ (T=4K固定)"

  # デフォルトのシート名（input_files内で指定がない場合に使用）
  sheet_name: "Normalized Data"
  
  # 結果を出力する親ディレクトリ名
  results_parent_dir: "fullsize_analysis_results_unified_gpu"

# --- 実行環境設定 ---
execution:
  # GPU (NVIDIA CUDA/JAX) を使用するかどうか (true/false)
  use_gpu: true

# --- 物理パラメータ・初期値 ---
physical_parameters:
  # ※ 固定磁場・固定温度の設定は input_files 内の fixed_param に移行しました
  
  # 膜厚 (meter) - 固定値として使用
  d_fixed: 157.8e-6
  # スピン量子数
  s: 3.5
  # スピン密度 (m^-3)
  N_spin: 1.9386e+28 # 24 / 1.238 * 1e27

  # --- パラメータの初期値 ---
  initial_values:
    eps_bg: 14.20
    g_factor: 1.990    # 初期値（ベイズ推定で更新される）
    B4: 0.000300       # 結晶場パラメータB4の初期値
    B6: 0.000030       # 結晶場パラメータB6の初期値
    gamma: 0.11e12     # 減衰定数γの初期値
    a_scale: 0.70      # スケーリング係数の初期値

# --- 解析条件設定 ---
analysis_settings:
  # 周波数領域のカットオフ値 (THz)
  low_freq_cutoff: 0.361505   # 低周波カットオフ（ピーク分類用）
  high_freq_cutoff: 0.45      # 高周波カットオフ（eps_bgフィッティング用）
  
  # --- 重み付け設定 ---
  weight_settings:
    # ピーク検出の閾値設定
    peak_height_threshold: 0.01      # ピーク検出の最小高さ（正規化透過率）
    # 低周波ピーク検出のため、閾値を緩和
    peak_prominence_threshold: 0.04  # ピーク検出の最小顕著度（正規化透過率）
    peak_distance: 10                # ピーク間の最小距離（データ点数）
    
    # 重み値設定  
    lp_up_peak_weight: 1.0          # LP・UPピーク領域の重み
    between_peaks_weight: 0.1       # LP-UP間の重み
    high_freq_peak_weight: 1.0      # 高周波ピークの重み
    background_weight: 0.01         # その他の領域の重み（バックグラウンド）

# --- ベイズ推定事前分布設定 ---
bayesian_priors:
  # 磁気パラメータの事前分布設定（初回実行時）
  magnetic_parameters:
    # a_scale パラメータ (HalfNormal分布)
    a_scale:
      distribution: "HalfNormal"
      sigma: 1.0
    
    # g因子 (Normal分布)
    g_factor:
      distribution: "Normal"
      mu: 2.0
      sigma: 0.1
    
    # 結晶場パラメータ B4 (Normal分布)
    B4:
      distribution: "Normal"
      mu: 0.0005
      sigma: 0.0001
    
    # 結晶場パラメータ B6 (Normal分布)
    B6:
      distribution: "Normal"
      mu: 0.00005
      sigma: 0.00001
  
  # gamma（減衰定数）関連の事前分布設定
  gamma_parameters:
    # log(gamma)のベース値
    log_gamma_mu_base:
      distribution: "Normal"
      mu: 25.0
      sigma: 1.0
    
    # log(gamma)の分散
    log_gamma_sigma_base:
      distribution: "HalfNormal"
      sigma: 0.3
    
    # 各遷移のoffset
    log_gamma_offset_base:
      distribution: "Normal"
      mu: 0.0
      sigma: 0.3
      shape: 7
    
    # 温度依存性係数
    temp_gamma_slope:
      distribution: "Normal"
      mu: 0.0
      sigma: 0.01
  
  # ノイズパラメータ
  noise_parameters:
    sigma:
      distribution: "HalfNormal"
      sigma: 0.05

# --- MCMCサンプリング設定 ---
mcmc:
  # サンプリング数（チェーンごと）
  draws: 2000
  # チューニング（warmup）期間
  tune: 1000
  # 並列チェーン数
  chains: 4
  # 受理率の目標値
  target_accept: 0.85
  # パラメータ更新の反復回数
  max_iterations: 2
  # 初期化戦略
  init: "adapt_diag"
  # 再現性確保のための乱数シード
  random_seed: 42
  # GPU並列計算用のサンプラーを指定 (numpyro)
  nuts_sampler: "numpyro"

# --- 出力設定 ---
output:
  # 保存するファイル
  save_trace: true              # traceファイル（.nc）を保存
  save_parameters: true         # パラメータCSVを保存
  save_bt_params: true          # (B,T)別光学パラメータCSVを保存