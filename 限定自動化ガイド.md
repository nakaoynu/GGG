# GGG自動化フィッティング 対象領域限定ガイド

## 概要

GGGの透過スペクトル自動フィッティングにおいて、計算時間の短縮や特定領域での精密な解析のために、自動化の対象領域を限定する機能を追加しました。

## 提供されるスクリプト

### 1. `GGG_simulation_auto_fit_B_limited.py`
- 最適化設定をスクリプト内で直接設定, gamma = {gamma.average * 1e-9:.2f} GHz (avg)
- 簡単な設定変更に適している

### 2. `GGG_configurable_fitting.py` ＋ `fitting_config.ini`
- 外部設定ファイルで詳細な制御が可能
- 設定の保存・管理が容易
- 複数の設定パターンを切り替えて使用可能

## 限定可能な領域

### 1. パラメータ最適化の限定 (`limited_params`)

**フルモード** (limited_params = False):
- 最適化対象: d (膜厚), eps_bg (背景誘電率), gamma (緩和定数), a_param (スケーリング係数)
- 計算時間: 長い
- 精度: 高い（全パラメータを考慮）

**限定モード** (limited_params = True):
- 最適化対象: gamma, a_param のみ
- 固定パラメータ: d, eps_bg（実験条件から既知の値を使用）
- 計算時間: 短い
- 精度: 特定パラメータに焦点を当てた最適化

```ini
[optimization_settings]
limited_params = True    # パラメータを限定

[parameter_settings]
d_fixed = 0.1578e-3     # 膜厚を固定
eps_bg_fixed = 12.0     # 背景誘電率を固定
gamma_min = 1e11        # 緩和定数の下限
gamma_max = 5e12        # 緩和定数の上限
a_param_min = 0.5       # スケーリング係数の下限
a_param_max = 5.0       # スケーリング係数の上限
```

### 2. 周波数範囲の限定 (`limited_frequency`)

**フルモード** (limited_frequency = False):
- 周波数範囲: 0.1 THz ～ 実験データの最大周波数
- データポイント: 500点
- 計算時間: 長い

**限定モード** (limited_frequency = True):
- 周波数範囲: 指定した範囲のみ（例：0.5-2.0 THz）
- データポイント: 300点
- 計算時間: 短い
- 用途: 特定の共鳴ピークに焦点を当てた解析

```ini
[frequency_settings]
freq_min = 0.5          # 最小周波数 [THz]
freq_max = 2.0          # 最大周波数 [THz]
freq_points = 300       # 周波数ポイント数
```

### 3. モデル形式の限定 (`single_model`)

**両モデル** (single_model = False):
- 最適化対象: H形式とB形式の両方
- 計算時間: 長い
- 用途: モデル比較

**単一モデル** (single_model = True):
- 最適化対象: 指定したモデルのみ
- 計算時間: 半分
- 用途: 特定モデルの詳細解析

```ini
[optimization_settings]
single_model = True     # 単一モデルのみ最適化
target_model = B_form   # 対象モデル (H_form/B_form)
```

## 使用例

### シナリオ1: 高速プロトタイピング
```ini
[optimization_settings]
limited_params = True
limited_frequency = True
single_model = True
target_model = B_form

[frequency_settings]
freq_min = 1.0
freq_max = 1.5
```
→ 1.0-1.5 THz の範囲で B形式モデルのみ、限定パラメータで最適化
→ 計算時間: 最短

### シナリオ2: 特定共鳴の詳細解析
```ini
[optimization_settings]
limited_params = False
limited_frequency = True
single_model = False

[frequency_settings]
freq_min = 0.8
freq_max = 1.2
freq_points = 500
```
→ 共鳴周波数周辺の詳細解析

### シナリオ3: 既知パラメータでの検証
```ini
[optimization_settings]
limited_params = True
limited_frequency = False
single_model = False

[parameter_settings]
d_fixed = 0.1578e-3     # 実測値
eps_bg_fixed = 14.44    # 文献値
```
→ 物理的パラメータのみを最適化

## 計算時間の目安

| 設定 | 相対計算時間 | 用途 |
|------|-------------|------|
| 全設定フル | 100% | 完全な解析 |
| limited_params | 70% | パラメータ限定 |
| limited_frequency | 60% | 周波数限定 |
| single_model | 50% | モデル限定 |
| 全設定限定 | 20% | 高速プロトタイピング |

## 設定ファイルの編集方法

1. `fitting_config.ini` をテキストエディタで開く
2. 必要な設定を変更
3. `GGG_configurable_fitting.py` を実行

## 出力ファイル

- `limited_fitting_result.png`: 結果プロット
- ターミナル出力: 最適化パラメータと誤差

## 注意事項

### パラメータ固定時の考慮点
- 固定パラメータは実験条件や文献値に基づいて設定
- 固定値が適切でない場合、最適化結果が物理的に不合理になる可能性

### 周波数範囲限定時の注意
- 重要な共鳴ピークを含む範囲を選択
- 範囲が狭すぎると最適化が不安定になる可能性

### モデル選択の指針
- 予備解析や文献調査に基づいてモデルを選択
- 不確実な場合は両モデルでの比較を推奨

## トラブルシューティング

### 最適化が失敗する場合
1. パラメータ範囲を広げる
2. 初期値を変更する
3. 周波数範囲を調整する

### 結果が物理的に不合理な場合
1. 固定パラメータの値を見直す
2. 最適化範囲を調整する
3. 実験データの前処理を確認する

## 拡張可能性

このフレームワークは以下のような拡張が可能：

- 新しい制約条件の追加
- 多目的最適化への対応
- 並列計算による高速化
- 機械学習手法の統合

設定ファイルベースの設計により、新しい機能の追加が容易です。
